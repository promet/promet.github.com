<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: HowTo | Linux Sysadmin Blog]]></title>
  <link href="http://linuxsysadminblog.com/category/howto/atom.xml" rel="self"/>
  <link href="http://linuxsysadminblog.com/"/>
  <updated>2012-11-22T11:07:24+08:00</updated>
  <id>http://linuxsysadminblog.com/</id>
  <author>
    <name><![CDATA[Promet OPS Team]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[HowTo: Bulk Import DNS Zones to Softlayer DNS using Cpanel]]></title>
    <link href="http://linuxsysadminblog.com/2012/11/howto-bulk-import-dns-zones-to-softlayer-dns-using-cpanel/"/>
    <updated>2012-11-13T01:08:00+08:00</updated>
    <id>http://linuxsysadminblog.com/2012/11/howto-bulk-import-dns-zones-to-softlayer-dns-using-cpanel</id>
    <content type="html"><![CDATA[<p>This guide covers the process for doing bulk import of existing DNS zones from a Cpanel or BIND server to Softlayer's DNS servers (<em>ns1/ns2.softlayer.com</em>).  This is useful if you need to add hundreds of zones, if for example you are moving your DNS hosting servers to Softlayer's free DNS hosting.  Currently, Softlayer doesn't have a tool to do bulk import of zones with existing records. Although you can create a default zone template and bulk add zones but this doesn't fit for existing zones.</p>

<h3>Requirements:</h3>

<p>1.) DNS zones on a Cpanel server (WHM or DNSOnly).</p>

<p>If you are not using a Cpanel server then you can stand up a Cpanel VPS this process and install Cpanel DNSOnly as it is free or install Cpanel WHM and automatically it will have 15-day trial license, or you can get a one month WHM VPS license for $15/month.
DNSOnly should be fine and easier/faster to install but you cannot view the DNS zones from its UI, although you can view or edit the zone files directly (<em>ex: /var/named/domain.db</em>).
Then import your zones to Cpanel server. There are lots of guides or discussions online in doing this. Some mentioned that you can move the named.conf and zone files as-is and adjust the formatting to match Cpanel's.
In our case we were running Cpanel server so we copied straight our "/var/named/*.db" files to Cpanel DNSOnly to import zones.</p>

<p>2.) Softlayer API key for your account.</p>

<p>  You will need this later to connect your Cpanel DNS server in a cluster setup with Softlayer's DNS servers. Cpanel have DNS cluster functionality with SoftLayer and VPS.NET.</p>

<h3>The Import Process:</h3>

<p>1.) Configure your Cpanel DNS cluster to connect to Softlayer's DNS servers.</p>

<!--more-->


<ul>
<li>Login to Cpanel WHM or DNSOnly, then go to <em>Cluster/Remote Access</em>  ->> <em>Configure Cluster</em>.</li>
<li>select <em>Enable DNS clustering</em></li>
<li>On <em>Backend Type</em> dropdown, you will see <em>cPanel</em> only. Then click on <em>(Show All)</em> link next to it and the page will reload and you will see two more options: <em>Softlayer</em> and <em>VPS.NET</em>. Select <em>Softlayer</em> and click on *Configure button.
<a href="http://linuxsysadminblog.com/images/2012/cluster-setup.png"><img src="http://linuxsysadminblog.com/images/2012/cluster-setup.png" alt="cluster-setup" /></a></li>
<li>On <em>SoftLayer DNS Remote Configuration</em> page, enter your Softlayer API user and key. On <em>DNS role</em> choose <em>Synchronize changes</em> from dropdown list and click on <em>Submit</em>.
<a href="http://linuxsysadminblog.com/images/2012/softlyer-dns-config.png"><img src="http://linuxsysadminblog.com/images/2012/softlyer-dns-config.png" alt="softlyer-dns-config" /></a></li>
</ul>


<p>2.) Synchronize DNS Records across clusters. DNS Cluster is now your Cpanel server and Softlayer servers.</p>

<ul>
<li>From Cpanel WHM or DNSOnly admin, go to * DNS Functions<em> ->> </em>Synchronize DNS Records*</li>
<li>Select <em>Synchronize all zones to all servers</em> and check the box that says <em>Synchronize zones that are not configured on this server</em>. Then hit <em>Synchronize</em> button.
<a href="http://linuxsysadminblog.com/images/2012/sync-dns.png"><img src="http://linuxsysadminblog.com/images/2012/sync-dns.png" alt="sync-dns" /></a></li>
<li>The dns sync process will run and it will take some time depending on the number of zones and records that you have. Wait until it's finish and you're done.</li>
<li>Once this starts you can login to your Softlayer portal and go to <em>Public Network</em> ->> <em>Domain Name System</em> and you will start seeing zones and see the progress on how many are imported.</li>
</ul>


<p><em>That is all. You can shutdown or remove your Cpanel DNSOnly/WHM server when if not needed.</em></p>

<h3>Notes:</h3>

<ul>
<li>Cpanel have DNS cluster functionality with SoftLayer and VPS.NET so you might be able to use this guide to bulk import zones to VPS.NET.</li>
<li>At this time of writing, we encountered a problem with Cpanel DNS cluster integration with Softlayer and we cannot modify the dns records that were imported initially.  When we update them it reverts to the original records from initial import. We disabled the DNS cluster setup from Cpanel and we update our DNS zones/records right from Softlayer portal.</li>
<li>Above info refers to BIND server as the default DNS server on Cpanel.</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[rsback: task x is locked and cannot be executed]]></title>
    <link href="http://linuxsysadminblog.com/2012/07/rsback-task-x-is-locked-and-cannot-be-executed/"/>
    <updated>2012-07-24T16:40:00+08:00</updated>
    <id>http://linuxsysadminblog.com/2012/07/rsback-task-x-is-locked-and-cannot-be-executed</id>
    <content type="html"><![CDATA[<p><em>Rsback Error</em>:
<code>
  rsback: [date/time] *** task 'x' is locked and cannot be executed.
</code></p>

<p>I got the above error when I was trying to re-run the rsback task that I previously killed its schedule backup process.  I had issue with the server being backup so I had to terminate the process.</p>

<p>This error shows up and prevents the backup task from running because the lock file is still present, which indicats that a process could still be running.  In order to fix this you need to remove the lock file and re-run the backup task.  Look at your rsback config (<em>/etc/rsback/rsback.conf</em>) to find out the location of your rsback lock files, default is "<em>lock_dir = /var/lock/subsys</em>".  In there you will see rsback lock files as "<em>rsback.backup_task_name.lock</em>", and just delete that file.</p>

<p>For those who doesn't know or heard of <a href="http://sourceforge.net/projects/rsback/">rsback</a> below is a short description from sourceforge.</p>

<p>  <em>rsback makes rotating backups using the common rsync program combined with hard-link copies on Unix-based backup hosts. This results in a fast and disk space saving backup technique.</em></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Restore Xen VM from LVM Snapshot Backups]]></title>
    <link href="http://linuxsysadminblog.com/2012/06/restore-xen-vm-from-lvm-snapshot-backups/"/>
    <updated>2012-06-22T20:21:00+08:00</updated>
    <id>http://linuxsysadminblog.com/2012/06/restore-xen-vm-from-lvm-snapshot-backups</id>
    <content type="html"><![CDATA[<p>What's the use of backups if you can't restore from them? ;)</p>

<p>In the previous post on "Backup Xen with LVM and Rsnapshot" we worked on creating backups of Xen (guest/domain) VMs with LVM, and here we'll cover the process of restoring from these backups.</p>

<p>What is covered here:</p>

<p>Restoring specific files or directories
Doing "bare-metal" type of restore. We will re-create the VM from our rsnapshot backups.
Restore Process:</p>

<p>1.) Restoring specific files or directories only</p>

<p>While this restore scenario is a no-brainer, still I'll just want to mention it here as well.  Basically this one is the usual copying of files (via cp, scp, ftp, rsync, etc) from your source or backup server to the destination server.</p>

<p>2.) "Bare-metal" restore (creates complete vm image from backup).</p>

<p>Overview of "bare-metal" restore process:</p>

<p>create, format, and mount logical volumes to use on the vm that you want to restore or re-create, based on its original vm disk properties such as size, names, etc.
copy all files from backup location to the newly mounted lvm disk</p>

<!--more-->


<p>adjust necessary xen vm configs (if any, like new ip address) and start/create the vm using the volume with restored contents or files, and you're done.
In the restore example below I'll refer to the vm as "domain.com" and we will restore the backups to a different volume with the same config as the original.  Then we'll start the vm, domain.com, using the restored volume.</p>

<p>Here's the sample VM configuration that we will use.
orignal vm disks: /dev/vg0/domain.com-disk (10GB) and /dev/vg0/domain.com-swap (512MB)
backup located at "/backup" of host machine
disks configurations to use on restored vm: /dev/vg0/domain-restore.com-disk (10GB) and /dev/vg0/domain-restore.com-swap (512MB)
To start we determine the virtual machine  to restore as well as the backup to use  for restore.</p>

<p>Then we'll create logical volumes with the same values as the running volumes as defined in our /etc/xen/domain.com.cfg.  Please note that you don't have to re-create the swap disk if you want, but in this example we'll just create another one.</p>

<p>```</p>

<pre><code>lvcreate -L 10G -n domain-restore.com-disk vg0
lvcreate -L 512M -n domain-restore.com-swap vg0
</code></pre>

<p>```
Format the "-disk" and mount it somewhere on host machine (ex: /backup-restore) and copy backup files into it, and unmount it after copying.</p>

<p>```</p>

<pre><code>mkfs -t ext3 -v /dev/vg0/domain-restore.com-disk
mkdir /backup-restore
mount /dev/vg0/domain-restore.com-disk /backup-restore
cp -rpfv /backup/domain.com-disk/* /backup-restore/
umount /dev/vg0/domain-restore.com-disk
rmdir /backup-restore
</code></pre>

<p>```
We now have the volume that contains the restored files at /dev/vg0/domain-restore-disk and ready to use by our domain.com VM.</p>

<p>Let's shutdown "domain.com" machine and change its disk configuration to use the new/restored volume.</p>

<p><code>
xm shutdown domain.com
</code></p>

<p>Then we'll update our vm xen config to let our "domain.com" vm use the "domain-restore-disk".  We'll modify /etc/xen/original.domain.com.cfg and change the disks to point to new volumes with restored contents.</p>

<p>From:
<code>
'phy:/dev/vg0/domain.com-disk,xvda2,w',
'phy:/dev/vg0/domain.com-swap,xvda1,w',
</code></p>

<p>To:
<code>
'phy:/dev/vg0/domain-restore.com-disk,xvda2,w',
'phy:/dev/vg0/domain-restore.com-swap,xvda1,w',
</code></p>

<p>Start our domain.com machine on its restored contents.</p>

<p><code>
xm create /etc/xen/domain.com.cfg
</code></p>

<p>That's all - you should have your vm running from its restored state! If everything is not ok you can quickly configure your vm to use the original volumes and restart it.</p>

<p>If you do not want to touch your live machine, you can just create another vm with the same config as the live one, create new volumes and restore your backups to that vm.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Debian 6: Backup Xen with LVM and Rsnapshot]]></title>
    <link href="http://linuxsysadminblog.com/2012/06/debian-6-backup-xen-with-lvm-and-rsnapshot/"/>
    <updated>2012-06-22T05:38:00+08:00</updated>
    <id>http://linuxsysadminblog.com/2012/06/debian-6-backup-xen-with-lvm-and-rsnapshot</id>
    <content type="html"><![CDATA[<p>This is a draft of my installation process which is mainly based from this blog:  <a href="http://backdrift.org/efficient-xen-backups-using-lvm-and-rsnapshot">Efficient Xen Backups Using LVM and Rsnapshot</a>.</p>

<p>Our setup is on Debian 6 server with 2TB disk running 10 vpses. We followed the above guide with notes on errors we encountered, mostly rsnapshot related. We are keeping daily backup locally, on a separate partition, and copies them to our remote server every week.</p>

<p>The Setup (mostly defaults):
vg path is /dev
vg name is vg0</p>

<p>Setup Process:</p>

<p>Create logical partition to store backups locally.  Size is 100GB and named it backups.  Format it with ext3 and mounted it to /backups.</p>

<p><code>
lvcreate -L 100G -n backups vg0
mkfs -t ext3 -v /dev/vg0/backups
mkdir /backups
mount /dev/vg0/backups /backups
</code></p>

<p>Install and configure rsnapshot.  Make sure you use TAB correctly as it will complain or give you an error if you don't.</p>

<p><code>
aptitude install rsnapshot
vi /etc/rsnapshot.conf
</code></p>

<p>Here's my rsnapshot config changes and/or additions:</p>

<!--more-->


<p>```
snapshot_root /backups/    #this is a mounted partition
interval daily 1    # i removed all other schedule and one daily copy only
linux_lvm_cmd_lvcreate /sbin/lvcreate
linux_lvm_cmd_lvremove /sbin/lvremove
linux_lvm_cmd_mount /bin/mount
linux_lvm_cmd_umount /bin/umount
linux_lvm_snapshotsize 2G
linux_lvm_snapshotname rsnapshot
linux_lvm_vgpath /dev
linux_lvm_mountpath /mnt/lvm-snapshot</p>

<h1>Backups Tasks for all VMs</h1>

<p>backup lvm://vg0/vm_1_name_disk/ vm_1_name_disk/
backup lvm://vg0/vm_2_name_disk/ vm_2_name_disk/
backup lvm://vg0/vm_10_name_disk/ vm_10_name_disk/
```</p>

<p>Schedule daily backup task in crontab (/etc/crontab). Note that rsnapshot is in /usr/bin/rsnapshot on Debian.</p>

<p><code>
01 01 * * * root /usr/bin/rsnapshot daily
</code></p>

<p>You can then run the rsnapshot task to make sure everything is working, from your config file to creating and mounting lvm snapshots. Execution time depends on number of vms and their size. You can ran them individually if needed.</p>

<p><code>
/usr/bin/rsnapshot daily
</code></p>

<p>Then I setup another backup task from remote backup server to pick up our local backups at /backups. You can also configure rsnapshot to backup your snapshots directly to your remote backup location (usiang rsync/ssh), depends on how you want to backup your data.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Gitolite: Add, Edit, or Delete Git Repository Name]]></title>
    <link href="http://linuxsysadminblog.com/2012/06/gitolite-add-edit-or-delete-git-repository-name/"/>
    <updated>2012-06-05T06:23:23+08:00</updated>
    <id>http://linuxsysadminblog.com/2012/06/gitolite-add-edit-or-delete-git-repository-name</id>
    <content type="html"><![CDATA[<p>I can't find commands in gitolite to manage repository or project name, so here's what I got from other sources.</p>

<p><strong>Add or create repository</strong></p>

<ul>
<li>Add entry for new project or repository in your gitolite config (<em>conf/gitolite.conf</em>)</li>
<li>Commit and push your changes. this will create and initialize your new repo.</li>
</ul>


<p><strong>Rename a repository</strong></p>

<ul>
<li>Modify the name of repo in your gitolite config (<em>conf/gitolite.conf</em>)</li>
<li>Move or rename the actual directory (depending on where you install it, ex: <em>/home/git/repositories</em>) to match your changes in gitolite config.</li>
<li>Commit and push your changes.</li>
</ul>


<p><strong>Note</strong>: Obviously, this changes the remote url of your repo, so don't forget to change your git remote url config in your project clones.</p>

<p><strong>Delete a repository</strong>:</p>

<ul>
<li>Open your gitolite config and remove the project from there. commit and push your changes.</li>
<li>Then delete its git directory (ex: /home/git/repositories/projectname.git)</li>
<li>You can also remove users/keys that are no longer used</li>
</ul>

]]></content>
  </entry>
  
</feed>
