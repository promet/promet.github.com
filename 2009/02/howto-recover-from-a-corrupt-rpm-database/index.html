
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>HowTo recover from a corrupt rpm database - Linux Sysadmin Blog</title>
  <meta name="author" content="Promet OPS Team">

  
  <meta name="description" content="RedHat based systems (rhel/fedora/centos) use rpm/yum to install and upgrade packages. If the rpm database gets corrupted in some way it will break &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://linuxsysadminblog.com/2009/02/howto-recover-from-a-corrupt-rpm-database/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Linux Sysadmin Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<!-- Google Form for Contact Page -->
<!-- jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script type="text/javascript">
    // Avoid conflict with ender.js.
jQuery.noConflict();
</script>
<!-- jQuery Form Plugin -->
<script src="http://malsup.github.com/jquery.form.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.9/jquery.validate.min.js"></script> 
<script src="/javascripts/google_form.js"></script>
<!-- Google Form for Contact Page End here -->


  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-120251-38']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Linux Sysadmin Blog</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:linuxsysadminblog.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/our-team">Our Team</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/about">About</a></li>
  <li><a href="/blog/contact">Contact</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      

<div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">HowTo Recover From a Corrupt Rpm Database</h1>
    
    
      <p class="meta">
        
  


<span class="byline author vcard">Posted by <span class="fn"><a href="/blog/our-team/marius-ducea.html">Marius Ducea</a></span></span>

 - 








  


<time datetime="2009-02-10T06:27:13+08:00" pubdate data-updated="true">Feb 10<span>th</span>, 2009</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>RedHat based systems (rhel/fedora/centos) use rpm/yum to install and upgrade packages. If the <strong>rpm database gets corrupted</strong> in some way it will break all the functionality of rpm and other tools that rely on it like yum for example. We have seen this either showing some errors on the console, or most frequently just by hanging and not performing any rpm related operations (even simple view operations like rpm -qa, or yum update, etc.). You will have to kill the processes and then find a way to rebuild your rpm database. <em>This post will show how to rebuild your rpm database and bring back to life your rpm command.</em></p>

<p>First we need to <strong>backup our existing database</strong> (just in case); this is located in <strong>/var/lib/rpm</strong> and depending on your distribution the content of the folder might look like this:
<code>/var/lib/rpm
-rw-r--r--  1 rpm  rpm   5464064 Feb  9 04:17 Basenames
-rw-r--r--  1 rpm  rpm     12288 Feb  3 05:03 Conflictname
-rw-r--r--  1 root root        0 Aug 25 02:48 __db.000
-rw-r--r--  1 root root    24576 Aug 14 04:02 __db.001
-rw-r--r--  1 root root  1318912 Aug 14 04:02 __db.002
-rw-r--r--  1 root root   450560 Aug 14 04:02 __db.003
-rw-r--r--  1 rpm  rpm   1982464 Feb  9 04:17 Dirnames
-rw-r--r--  1 rpm  rpm   5259264 Feb  9 04:17 Filemd5s
-rw-r--r--  1 rpm  rpm     24576 Feb  9 04:17 Group
-rw-r--r--  1 rpm  rpm     28672 Feb  9 04:17 Installtid
-rw-r--r--  1 rpm  rpm     45056 Feb  9 04:17 Name
-rw-r--r--  1 rpm  rpm  31707136 Feb  9 04:17 Packages
-rw-r--r--  1 rpm  rpm    339968 Feb  9 04:17 Providename
-rw-r--r--  1 rpm  rpm    106496 Feb  9 04:17 Provideversion
-rw-r--r--  1 rpm  rpm     12288 Dec  2 08:45 Pubkeys
-rw-r--r--  1 rpm  rpm    253952 Feb  9 04:17 Requirename
-rw-r--r--  1 rpm  rpm    167936 Feb  9 04:17 Requireversion
-rw-r--r--  1 rpm  rpm     86016 Feb  9 04:17 Sha1header
-rw-r--r--  1 rpm  rpm     49152 Feb  9 04:17 Sigmd5
-rw-r--r--  1 rpm  rpm     12288 Jan 15 21:09 Triggername</code></p>

<p>Let&#8217;s just <strong>backup </strong>all the /var/lib/rpm folder to have its original state:
<code>cd /var/lib
tar czvf rpmdb.tar.gz rpm</code></p>

<p>Finally let&#8217;s <strong>rebuild </strong>the rpm database:
<code>cd /var/lib/rpm
rm -f __db*
rpm --rebuilddb -vv</code></p>

<p>After this, your rpm commands should be working again. (just try a <em>yum update</em> or a rpm query like: <em>rpm -qa php</em>). If this will not fix it try to see what error messages you got from the above commands or from your system logs.</p>
</div>


  <footer>
    <p class="meta">
      
  


<span class="byline author vcard">Posted by <span class="fn"><a href="/blog/our-team/marius-ducea.html">Marius Ducea</a></span></span>


      








  


<time datetime="2009-02-10T06:27:13+08:00" pubdate data-updated="true">Feb 10<span>th</span>, 2009</time>
      

<span class="categories">
  
    <a class='category' href='/category/centos/'>Centos</a>, <a class='category' href='/category/sysadmin/'>sysadmin</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://linuxsysadminblog.com/2009/02/howto-recover-from-a-corrupt-rpm-database/" data-via="linuxsysadmnblg" data-counturl="http://linuxsysadminblog.com/2009/02/howto-recover-from-a-corrupt-rpm-database/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2009/02/upgrade-to-java-se-6-update-12-on-fedora-10/" title="Previous Post: Upgrade to Java SE 6 update 12 on Fedora 10 ">&laquo; Upgrade to Java SE 6 update 12 on Fedora 10 </a>
      
      
        <a class="basic-alignment right" href="/2009/02/cisco-asa-5505-activestandby-failover-configuration/" title="next Post: Cisco ASA 5505: Active/Standby Failover Configuration">Cisco ASA 5505: Active/Standby Failover Configuration &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2012/11/howto-bulk-import-dns-zones-to-softlayer-dns-using-cpanel/">HowTo: Bulk Import DNS Zones to Softlayer DNS using Cpanel</a>
      </li>
    
      <li class="post">
        <a href="/2012/08/integrate-sendgrid-with-redmine/">Integrate Sendgrid with Redmine</a>
      </li>
    
      <li class="post">
        <a href="/2012/07/rsback-task-x-is-locked-and-cannot-be-executed/">rsback: task x is locked and cannot be executed</a>
      </li>
    
      <li class="post">
        <a href="/2012/06/restore-xen-vm-from-lvm-snapshot-backups/">Restore Xen VM from LVM Snapshot Backups</a>
      </li>
    
      <li class="post">
        <a href="/2012/06/debian-6-backup-xen-with-lvm-and-rsnapshot/">Debian 6: Backup Xen with LVM and Rsnapshot</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/promet">@promet</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'promet',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("linuxsysadmnblg", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/linuxsysadmnblg" class="twitter-follow-button" data-show-count="false">Follow @linuxsysadmnblg</a>
  
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Promet OPS Team -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'linuxsysadminblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://linuxsysadminblog.com/2009/02/howto-recover-from-a-corrupt-rpm-database/';
        var disqus_url = 'http://linuxsysadminblog.com/2009/02/howto-recover-from-a-corrupt-rpm-database/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
