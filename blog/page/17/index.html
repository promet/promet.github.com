
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Linux Sysadmin Blog</title>
  <meta name="author" content="Promet OPS Team">

  
  <meta name="description" content="Okay, I&#8217;ll make this short, we have several servers with Ffmpeg and later we found out that one of them is having problem on video conversion &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://linuxsysadminblog.com/blog/page/17/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Linux Sysadmin Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<!-- Google Form for Contact Page -->
<!-- jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script type="text/javascript">
    // Avoid conflict with ender.js.
jQuery.noConflict();
</script>
<!-- jQuery Form Plugin -->
<script src="http://malsup.github.com/jquery.form.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.9/jquery.validate.min.js"></script> 
<script src="/javascripts/google_form.js"></script>
<!-- Google Form for Contact Page End here -->


  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-120251-38']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Linux Sysadmin Blog</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:linuxsysadminblog.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/our-team">Our Team</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/about">About</a></li>
  <li><a href="/blog/contact">Contact</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/01/flvtool2-not-injecting-metadata-video-length/">FLVTool2 Not Injecting Metadata (Video Length)</a></h1>
    
    
      <p class="meta">
        
  


<span class="byline author vcard">Posted by <span class="fn"><a href="/blog/our-team/gerold-mercadero.html">Gerold Mercadero</a></span></span>

 - 








  


<time datetime="2009-01-06T07:59:42+08:00" pubdate data-updated="true">Jan 6<span>th</span>, 2009</time>
        
         | <a href="/2009/01/flvtool2-not-injecting-metadata-video-length/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Okay, I&#8217;ll make this short, we have several servers with Ffmpeg and later we found out that one of them is having problem on video conversion as it does not add the video length to the output file.  This issue was caused by older version of Flvtool2, version 1.0.5 RC6 and below.  So I upgraded my installation to latest release which is 1.0.6 final (this is the latest version at the time of this post).</p>

<p>You can check for the latest release at <a href="http://rubyforge.org/frs/?group_id=1096">RubyForge</a>.</p>

<p>Upgrade process is easy, same as the installation process, and if you need help visit our detailed guide on <strong>&#8220;<a href="http://linuxsysadminblog.com/2008/06/install-ffmpeg-ffmpeg-php-and-audio-binaries-on-centos-rhel-system-with-cpanel/">Installing ffmpeg and its components</a>&#8221;</strong> and look for Flvtool2 section.</p>

<p>If you&#8217;re still having problem after Flvtool2 upgrade check your Ruby installation as you may need to update it as well.  If you&#8217;re on a Cpanel server you can use Cpanel&#8217;s Ruby install script at <code>/scripts/installruby</code>&#8221;.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/01/beer-money-and-open-source-ad-network/">Beer Money and Open Source Ad Network</a></h1>
    
    
      <p class="meta">
        
  


<span class="byline author vcard">Posted by <span class="fn"><a href="/blog/our-team/andrew-kucharski.html">Andrew Kucharski</a></span></span>

 - 








  


<time datetime="2009-01-06T00:36:16+08:00" pubdate data-updated="true">Jan 6<span>th</span>, 2009</time>
        
         | <a href="/2009/01/beer-money-and-open-source-ad-network/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Beer money and open source ad network don&#8217;t really have anything to do with each other other than the fact that the sys admins of <a href="http://www.promethost.com">Promet Host</a> will get counting on some buying some beer this summer with the<a href="http://adbard.net/about"> [Ad Bard]</a> earnings.  That&#8217;s right, all proceeds this sprint will be used to buy us some beer.  </p>

<p>Here is what the good folks at [Ad Bard] are all about:</p>

<blockquote><p>At Ad Bard, we believe that advertisements can be an effective way for FLOSS oriented websites to generate regular income while remaining useful, relevant, and non-obnoxious.</p></blockquote>

<p>Our advertising community is entirely built with free/libre and open source software, with all involved algorithms and schemas freely available for public scrutiny.</p>

<p>Its also worth to note that their site is running on the <a href="http://www.drupal.org">Drupal</a> platform.</p>

<p>Linux System Admin Blog became an accepted member late last year and we plan on running some ads shortly.  So when you see our ads, be encouraged that they are part of the FLOSS community and will do us some good by supplying the badly needed happy hour.   Here is one right now&#8230;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/01/monitoring-a-java-application-from-nagios/">Monitoring a Java Application From Nagios</a></h1>
    
    
      <p class="meta">
        
  


<span class="byline author vcard">Posted by <span class="fn"><a href="/blog/our-team/pim-van-der-wal.html">Pim Van der Wal</a></span></span>

 - 








  


<time datetime="2009-01-05T16:16:47+08:00" pubdate data-updated="true">Jan 5<span>th</span>, 2009</time>
        
         | <a href="/2009/01/monitoring-a-java-application-from-nagios/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This is a slight departure from our regular programming. Instead of just concentrating on the sys admin side of things I want to show how to add a Nagios check to an existing application. In this case we have a Java application for which we want to monitor whether it is running or not. Later on we can make this more detailed by monitoring error codes in the application but for the moment let&#8217;s keep it simple.</p>

<p><strong>Configuring Nagios</strong></p>

<p>On the Nagios end of things we need to define a command to perform a check on a specific port of the server where the application is running. Add a line like this to the objects/commands.cfg file of your Nagios installation.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>define command{
</span><span class='line'>command_name check_your_application_name
</span><span class='line'>command_line $USER1$/check_tcp -H $HOSTADDRESS$ -p $ARG1$ -e "This application is alive and well"
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>The -e parameter checks for a specific text that is to be returned by the application. This we can use later on to check for more detailed information. Next we need to add a service to Nagios for using this command. We do this by adding the following lines to the objects/localhost.cfg file. To keep this short I left out some lines which configure the frequency of the checks and the types of alerts.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>define service {
</span><span class='line'>use                    generic-service
</span><span class='line'>host_name              your_server_name
</span><span class='line'>service_description    your_service_name
</span><span class='line'>check_command          check_your_application_name!2222
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p><strong>Creating a listener port in Java</strong></p>

<p>In the second part I will show you the actual code to add to your application. Because this is a blog post I left out the package definition and the includes, but other than that the class itself is usable. To add the check to the Java app we need to add a listener thread to application. We do this by creating a class that is derived from Thread. This listener will open a port which is specified by the main application and a respond to any incoming data with a preset text. We really don&#8217;t care about the input on this end so any input will be  ignored:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public class NagiosChecker extends Thread {
</span><span class='line'>    // Server socket
</span><span class='line'>    private ServerSocket srv;
</span><span class='line'>
</span><span class='line'>    // Flag that indicates whether the poller is running or not.
</span><span class='line'>    private boolean isRunning = true;
</span><span class='line'>
</span><span class='line'>    // Constructor.
</span><span class='line'>    public OVMChecker(ServerSocket srv) {
</span><span class='line'>        this.isRunning = true;
</span><span class='line'>        this.srv = srv;
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    // Method for terminating the listener
</span><span class='line'>    public void terminate() {
</span><span class='line'>        this.isRunning = false;
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    /**
</span><span class='line'>    * This method start the thread and performs all the operations.
</span><span class='line'>    */
</span><span class='line'>    public void run() {
</span><span class='line'>        try {
</span><span class='line'>            // Wait for connection from client.
</span><span class='line'>            while (isRunning) {
</span><span class='line'>                Socket socket = srv.accept();
</span><span class='line'>
</span><span class='line'>            // Open a reader to receive (and ignore the input)
</span><span class='line'>            BufferedReader rd = new BufferedReader(new InputStreamReader(socket.getInputStream()));
</span><span class='line'>
</span><span class='line'>            // Write the status message to the outputstream
</span><span class='line'>            try {
</span><span class='line'>                BufferedWriter wr = new BufferedWriter(new OutputStreamWriter(socket.getOutputStream()));
</span><span class='line'>                wr.write("This application is alive and well");
</span><span class='line'>                wr.flush();
</span><span class='line'>            } catch (IOException e) {
</span><span class='line'>                System.out.println(e.getMessage()));
</span><span class='line'>            }
</span><span class='line'>
</span><span class='line'>            // Close the inputstream since we really don't care about it
</span><span class='line'>            rd.close();
</span><span class='line'>        } catch (Exception e) {
</span><span class='line'>            System.out.println(e.getMessage()));
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>In case you&#8217;re still reading this you&#8217;re probably interested in how to call this class. The following code should be executed in the initialization of the application. It creates the actual socket for port 2222 and starts the listener class. After this the listener class will run indefinitely until the application terminates.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ServerSocket srv = null;
</span><span class='line'>try {
</span><span class='line'>    srv = new ServerSocket(2222);
</span><span class='line'>    NagiosChecker checker = new NagiosChecker(srv);
</span><span class='line'>    checker.start();
</span><span class='line'>} catch (Exception e) {
</span><span class='line'>    System.out.println(e.getMessage());
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/12/howto-change-the-timezone-on-rhelcentos/">HowTO Change the Timezone on RHEL/CentOS</a></h1>
    
    
      <p class="meta">
        
  


<span class="byline author vcard">Posted by <span class="fn"><a href="/blog/our-team/marius-ducea.html">Marius Ducea</a></span></span>

 - 








  


<time datetime="2008-12-16T05:05:17+08:00" pubdate data-updated="true">Dec 16<span>th</span>, 2008</time>
        
         | <a href="/2008/12/howto-change-the-timezone-on-rhelcentos/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Linux systems traditionally keep the definition of their <strong>timezone </strong>in <strong>/etc/localtime</strong>. This is a binary file with the timezone info, and if we want to change it we need to find the appropriate timezone file from <strong>/usr/share/zoneinfo</strong> and copy it over the one from /etc or just link to it. Once you change it, you will need to <strong>restart </strong>any daemons or applications that use the timezone as they might still use the old one.</p>

<p>Still on <strong>RHEL/Centos</strong> based systems this is not enough, and even if apparently all seems to work as expected, there might be some applications still using the old timezone. This is happening if they read the timezone definition from the rhel specific file: <strong>/etc/sysconfig/clock</strong>
<code>cat /etc/sysconfig/clock
ZONE="America/Chicago"
UTC=true
ARC=false</code></p>

<p>We also need to update the <strong>ZONE </strong>field in <strong>/etc/sysconfig/clock</strong> to be sure that all occurrences of the old timezone are changed and everything on the system will use the new setting.</p>

<p><em>Note</em>: you <em>don&#8217;t need to restart the system</em> to activate this change, but you will have to <strong>restart </strong>the applications using the timezone so they can read the updated information.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/12/mysql-query-optimization-for-network-throughput/">MySQL Query Optimization for Network Throughput</a></h1>
    
    
      <p class="meta">
        
  


<span class="byline author vcard">Posted by <span class="fn"><a href="/blog/our-team/pim-van-der-wal.html">Pim Van der Wal</a></span></span>

 - 








  


<time datetime="2008-12-10T10:42:46+08:00" pubdate data-updated="true">Dec 10<span>th</span>, 2008</time>
        
         | <a href="/2008/12/mysql-query-optimization-for-network-throughput/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It&#8217;s a bit of a long title for a blog post but the point I want to make is that not every query optimization is aimed at making the query faster. As a case in point we have a client that has a web shop and their network traffic between the web servers and the database servers has been sizable to say the least. There was a good amount of old code that probably worked pretty well when the shop just started out and had small amounts of data. Now the shop has grown certain queries suddenly don&#8217;t perform so good anymore.</p>

<p>On any weekday around lunch time network traffic between web and data servers was around 80Mb/s. On a 100Mb/s connection that is dangerously high and to address this we&#8217;ve been in the process of modifying queries that do a <code>SELECT *</code>. There really hardly ever is a reason to do a <code>SELECT *</code> except when you have very flexible code that automatically deals with extra columns. That was not the case with this application.</p>

<p>On Cyber Monday we found that traffic for this shop was touching 100Mb/s and web site performance really suffered. As a temporary measure we switched the database server to a 1Gb/s connection but both web servers stayed on 100Mb/s connections.</p>

<p>Looking at the slow query log and mtop revealed a ton of similar queries:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># User@Host: username[username] @  [10.0.0.123]
</span><span class='line'># Query_time: 2  Lock_time: 0  Rows_sent: 1948  Rows_examined: 2047
</span><span class='line'>SELECT * FROM sites, sites_to_bundle WHERE sites_to_bundle.sites_id = sites.sites_id AND sites.site_name ='shop1';</span></code></pre></td></tr></table></div></figure>


<p>In and by them selves these queries look pretty harmless. 2000 rows is not that much. Maybe more than is needed but not enough to choke up the network either. The problem turns out to be that this query was executed several times for each page in the check out process. The database server was not overloaded since it had the whole result set in its cache, but it had to transfer 2MB of data for each request. When a developer investigated it turned out that only one 2 digit value of the entire result set was used.</p>

<p>We rewrote query and pushed to production on that same day. Yes, I know that a previous blog post tells us not to do that but in this case I&#8217;m glad we did. Network traffic dropped below 10Mb/s and the web site was flying. Below is the Cacti graph that shows that difference. Shortly after 15:00 we implemented the optimization and traffic dropped dramatically.</p>

<p><a href="http://linuxsysadminblog.com/images/2008/12/network_traffic_improvement.png"><img src="http://linuxsysadminblog.com/images/2008/12/network_traffic_improvement.png" alt="" /></a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/12/vsftpd-logging-timestamp/">Vsftpd Logging Timestamp</a></h1>
    
    
      <p class="meta">
        
  


<span class="byline author vcard">Posted by <span class="fn"><a href="/blog/our-team/marius-ducea.html">Marius Ducea</a></span></span>

 - 








  


<time datetime="2008-12-09T03:23:41+08:00" pubdate data-updated="true">Dec 9<span>th</span>, 2008</time>
        
         | <a href="/2008/12/vsftpd-logging-timestamp/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>While investigating some ftp transfers issues we realized that there was something wrong with the logs generated by vsftpd. <strong>The timestamps reported in the vsftpd log were wrong</strong>, and the fact that they were always 5 hours behind the actual time made us think this was caused by a timezone issue. The system running this was the <strong>latest Centos 5.2</strong> with stock <strong>vsftpd </strong>package.</p>

<p>After further investigation we realized that vsftpd was <strong>not using the system timezone</strong> settings but was always logging its messages using <strong>GMT</strong>. Why would anyone want this? I have no idea, but imo they should change the default value to use the system timezone as that is what the majority of people would expect. In order to fix this, you just have to add to the <strong>vsftpd.conf</strong> the following line:
<code>use_localtime=YES</code>
as we can see from vsftpd manual page (<em>man vsftpd.conf</em>) if undefined, this defaults to &#8221;<strong>NO</strong>&#8221;:
&#8221;<em><strong>use_localtime</strong> - If  enabled, vsftpd will display directory listings with the time in your local time zone. The default is to display GMT. The times returned by the MDTM FTP command are also affected by this option.
Default: NO</em>&#8221;</p>

<p>After changing this variable as with any other vsftpd options, you have to restart the vsftpd service to activate the change.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/12/why-is-there-a-system-change-freeze-especially-on-black-monday-and-black-friday/">Why Is There a System Change Freeze - Especially on Black Monday and Black Friday?</a></h1>
    
    
      <p class="meta">
        
  


<span class="byline author vcard">Posted by <span class="fn"><a href="/blog/our-team/andrew-kucharski.html">Andrew Kucharski</a></span></span>

 - 








  


<time datetime="2008-12-03T18:53:34+08:00" pubdate data-updated="true">Dec 3<span>rd</span>, 2008</time>
        
         | <a href="/2008/12/why-is-there-a-system-change-freeze-especially-on-black-monday-and-black-friday/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When I started working in systems, one of my first client was a major bank.  Yes, this was back in the mainframe batch processing days.  They never did any system updates when they ran the month end, quarter end and especially year end.</p>

<p>I always thought that they just weren&#8217;t confident in their system folks and scoffed at this policy as it always made our deadlines shorter.</p>

<p>I think this story convinced me that doing production work these days on the bussiest web days is not a good idea.  Maybe microsoft should have borrowed a page from the mainframe policy manual - don&#8217;t do system updates on black monday or black friday as it may cause system outage.</p>

<p>This story: <a href="http://www.efluxmedia.com/news_Microsoft_Says_Sorry_For_Black_Friday_Cashback_Outage_30408.html">Microsoft Says Sorry For Black Friday Cashback Outage</a></p>

<blockquote><p>For Internet users, <a href="http://www.efluxmedia.com/news_Microsoft_Says_Sorry_For_Black_Friday_Cashback_Outage_30408.html#">Black Friday</a> was supposed to be about buying and cashing back, but <a href="http://www.efluxmedia.com/news_Microsoft_Says_Sorry_For_Black_Friday_Cashback_Outage_30408.html#">Microsoft’s</a> Live Search cashback machine apparently broke down just as customers “barged in” to make some early morning purchases.</p></blockquote>

<p>According to a blog posting, the unexpected outage occurred due to a significant spike in traffic, which caused the system to .html&#8221;>Buy Propecia  go down for several hours. It took quite a while for it to come back to life, but apparently that was related to investigating the issue and rebuilding and deploying the <a href="http://www.efluxmedia.com/news_Microsoft_Says_Sorry_For_Black_Friday_Cashback_Outage_30408.html#">databases</a> and indexes that support Microsoft Live Search Cashback.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/12/how-to-check-if-your-dns-server-implements-source-port-randomization/">How to Check if Your DNS Server Implements Source Port Randomization</a></h1>
    
    
      <p class="meta">
        
  


<span class="byline author vcard">Posted by <span class="fn"><a href="/blog/our-team/marius-ducea.html">Marius Ducea</a></span></span>

 - 








  


<time datetime="2008-12-02T06:11:40+08:00" pubdate data-updated="true">Dec 2<span>nd</span>, 2008</time>
        
         | <a href="/2008/12/how-to-check-if-your-dns-server-implements-source-port-randomization/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The <strong>Domain Name System</strong> (DNS) is responsible for translating host names to IP addresses (and vice versa) and is critical for the normal operation of internet-connected systems. <strong>DNS cache poisoning</strong> (sometimes referred to as cache pollution) is an attack technique that allows an attacker to introduce forged DNS information into the cache of a caching nameserver. DNS cache poisoning is not a new concept; in fact, there are published articles that describe a number of inherent deficiencies in the DNS protocol and defects in common DNS implementations that facilitate DNS cache poisoning.</p>

<p><strong>Fixed source port for generating queries</strong> – in most dns implementations the source port for outgoing queries is fixed at the traditional assigned DNS server port number, <strong>53/udp</strong>.
We can easily find out if our own dns server is using a fixed source port for queries by looking into <strong>named.conf</strong> and if we see a line like:
<code>query-source port 53;</code>
<em>this means that the port 53 udp will be used for <strong>all </strong>dns outgoing queries</em>.</p>

<p>This can be tested externally (you can check on your ISP resolvers for ex.) with the dig command:
<code>dig +short @&lt;IP_DNS_SERVER&gt; porttest.dns-oarc.net txt</code></p>

<p>Here is a sample output for a server not using source port randomization:
<code>dig +short @192.168.0.1 porttest.dns-oarc.net txt
porttest.y.x.w.v.u.t.s.r.q.p.o.n.m.l.k.j.i.h.g.f.e.d.c.b.a.pt.dns-oarc.net.
"192.168.0.1 is **POOR**: 26 queries in 2.0 seconds from 1 ports with std dev 0"</code></p>

<p>and also one for a server that does this:
<code>dig +short @192.168.0.2 porttest.dns-oarc.net txt
porttest.y.x.w.v.u.t.s.r.q.p.o.n.m.l.k.j.i.h.g.f.e.d.c.b.a.pt.dns-oarc.net.
"192.168.0.2 is **GREAT**: 26 queries in 1.2 seconds from 26 ports with std dev 5243"</code>
as this shows it is using <strong>random ports</strong> for each query.</p>

<p>Now if you want to be safe from this <a href="http://www.kb.cert.org/vuls/id/800113">vulnerability</a> you should <strong>upgrade to the latest bind version</strong> available (<strong>yum install bind</strong> if using rhel/centos/etc. or <strong>apt-get install bind9</strong> if you use debian/ubuntu) and also remove from your <strong>named.conf</strong> such lines:
<code>query-source port 53;
query-source-v6 port 53;</code>
and reload named afterwards:
<code>rndc reload</code></p>

<p>Once you are done check it again with dig and this should show now &#8217;<strong>GREAT</strong>&#8217; as expected.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/12/black-monday/">Black Monday</a></h1>
    
    
      <p class="meta">
        
  


<span class="byline author vcard">Posted by <span class="fn"><a href="/blog/our-team/andrew-kucharski.html">Andrew Kucharski</a></span></span>

 - 








  


<time datetime="2008-12-01T23:38:57+08:00" pubdate data-updated="true">Dec 1<span>st</span>, 2008</time>
        
         | <a href="/2008/12/black-monday/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>E-commercre Report; Several of the most popular online merchants have struggled to cope with the heavy holiday traffic, a survey shows.</p></blockquote>

<p>Ok, that was <a href="http://query.nytimes.com/gst/fullpage.html?res=9807E7DA103CF936A25751C1A9659C8B63">NYTimes 2003</a> – what about now?   This season there have already been several announcements of ecommerce snafus.  Sears.com site shut down for a couple of hours and there have even been rumors of apple.com having problems.</p>

<p>Although Snopes.com busts the claim of Cyber Monday as the busiest shopping day dollar wise, over the next five weeks eCommerce sites will experience their heaviest loads.</p>

<p>One interesting phenomenon that has emerged in the last few years is a sort of blending of the Black Friday and Cyber Monday concepts:  The day that produces the most web traffic to online retail sites is Thanksgiving Day itself, as avid shoppers use the Internet to plan their strategies for Black Friday weekend sales at brick and mortar stores:</p>

<blockquote><p>Matt Tahtam, a spokesman fo rHitwise, as company that tracks 100 of the largest online retailers, says there another trend that’s emerged over the last few holiday seasons: the gratest amount of online traffic (searching and visiting, though not necessairly buying) happening on turkey day itself.</p></blockquote>

<p>What is the biggest E-Shopping Day in History?  According to this Forbes article (<a href="http://www.forbes.com/2006/11/29/cyber-monday-shopping-record-biz-cx_tvr_1129shop.html">http://www.forbes.com/2006/11/29/cyber-monday-shopping-record-biz-cx_tvr_1129shop.html</a>)  :by tagging it as the unofficial start of the online holiday shopping season, saw a 26% gain in sales from the same day in 2005 to $608 million, according to industry tracker comScore Networks. The result, beating expectations, marked the single biggest shopping day in e-commerce history.</p>

<p>So what should a pragmatic system admin do about this?</p>

<ul>
<li>We don’t over sell your servers</li>
<li>Dont run bandwidth, CPU or any aspect of hosting at or near capacity</li>
<li>Monitor our servers and distribute load to make sure that when the big spike happens, we’re ready and your site stays up.</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/11/cpanel-adding-custom-configuration-to-httpdconf/">Cpanel: Adding Custom Configuration to httpd.conf</a></h1>
    
    
      <p class="meta">
        
  


<span class="byline author vcard">Posted by <span class="fn"><a href="/blog/our-team/gerold-mercadero.html">Gerold Mercadero</a></span></span>

 - 








  


<time datetime="2008-11-25T09:39:23+08:00" pubdate data-updated="true">Nov 25<span>th</span>, 2008</time>
        
         | <a href="/2008/11/cpanel-adding-custom-configuration-to-httpdconf/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recently, Cpanel implemented their standard way of adding custom changes to virtualhost configuration to preserve custom changes after an upgrade or Apache rebuild.</p>

<p>Here are the two common situations of adding custom changes:</p>

<p><strong>1.)  Changes added inside a <code>&lt;VirtualHost&gt;</code></strong></p>

<p>This is very simple as we only need to create a single file that will contain our changes.  But we need to understand the correct location on where to place this file so that our changes will be read properly.</p>

<p>There are several cases of adding these changes and below are some samples and the coresponding directory where to put them:</p>

<ul>
<li>One virtualhosts (either SSL or standard)</li>
</ul>


<p>Apache1/SSL:  <code>/usr/local/apache/conf/userdata/ssl/1/&lt;cpanel_user&gt;/&lt;domain&gt;/&lt;filename&gt;.conf</code>
Apache1/Standard:   <code>/usr/local/apache/conf/userdata/std/1/&lt;cpanel_user&gt;/&lt;domain&gt;/&lt;filename&gt;.conf</code>
Apache2/SSL:   <code>/usr/local/apache/conf/userdata/ssl/2/&lt;cpanel_user&gt;/&lt;domain&gt;/&lt;filename&gt;.conf</code>
Apache2/SSL:   <code>/usr/local/apache/conf/userdata/std/2/&lt;cpanel_user&gt;/&lt;domain&gt;/&lt;filename&gt;.conf</code></p>

<ul>
<li>All virtualhosts (both SSL and standard)</li>
</ul>


<p><code>Apache 1/2:   /usr/local/apache/conf/userdata/&lt;something&gt;.conf</code></p>

<ul>
<li>All SSL virtualhost or all Standard virtualhost</li>
</ul>


<p>Apache 1/2 - all SSL:  <code>/usr/local/apache/conf/userdata/ssl/&lt;filename&gt;.conf</code>
Apache 1/2 - all Standard:   <code>/usr/local/apache/conf/userdata/std/&lt;filename&gt;.conf</code></p>

<ul>
<li>If you need to put the above changes on a specific Apache version you can put them this way:</li>
</ul>


<p>Apache 1 - all SSL:   <code>/usr/local/apache/conf/userdata/ssl/1/&lt;filename&gt;.conf</code>
Apache 2 - all Standard:  <code>/usr/local/apache/conf/userdata/std/2/&lt;filename&gt;.conf</code></p>

<p>The same process is followed on subdomains, like on one of my implementation i added a custom virtualhost in a subdomain to take effect on standard (http), so i put it on this directory:
<code>/usr/local/apache/conf/userdata/ssl/2/gerold/mysubdomain.gerold.com/custom.conf</code></p>

<p>Take note that you also need to create the directories like <em>ssl</em>, <em>std</em>, <em>1</em>, <em>2</em>, or <em>mysubdomain.gerold.com</em>&#8221; in order to have the correct directory structure/path.</p>

<p>You can verify if your custom changes were added correctly using this command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/scripts/verify_vhost_includes</span></code></pre></td></tr></table></div></figure>


<p><strong>Then, update the include files</strong>:</p>

<p>For changes concerning single account/user you can use this command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/scripts/ensure_vhost_includes --user=&lt;username&gt;</span></code></pre></td></tr></table></div></figure>


<p>And for all users run:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/scripts/ensure_vhost_includes --all-users</span></code></pre></td></tr></table></div></figure>


<p>And finally, restart Apache (<code>/etc/init.d/httpd restart</code>)</p>

<p><strong>2.)  Changes added outside a <code>&lt;VirtualHost&gt;</code></strong></p>

<p>Adding custom changes outside of virtualhost can be done in different ways, like creating a templates or using the include editor.
On my example, i will discuss using Include editor as i usually used this on some of our client sites.</p>

<p><strong>Cpanel have three ways to place our custom changes using Include editor, these are:</strong></p>

<ul>
<li><strong>Pre-Main Include</strong> - this is placed at the top of the httpd.conf file
Location:  <code>/etc/httpd/conf/includes/pre_main_1.conf</code></li>
<li><strong>Pre-VirtualHost Include</strong> - codes in this file are added before the first Vhost configuration
Location:  <code>/etc/httpd/conf/includes/pre_virtualhost_1.conf</code></li>
<li><strong>Post-VirtualHost Include</strong> - codes in this file are added at the end of httpd.conf
Location:  <code>/etc/httpd/conf/includes/post_virtualhost_1.conf</code></li>
</ul>


<p>So to add our changes we can go to WHM:  <code>Main &gt;&gt; Service Configuration &gt;&gt; Apache Setup &gt;&gt; Include Editor</code>, and select where you want to place your custom changes (<em>pre-main, pre-vhost, or post-vhost</em>).
You can also edit directly the files (<em>pre_main_1.conf, pre_virtualhost_1.conf, post_virtualhost_1.conf</em>) located at <code>/etc/httpd/conf/includes/</code>.
Finally, restart Apache (<code>/etc/init.d/httpd restart</code>) for changes to take effect.</p>

<p><strong>NOTE: For complete referrence please refer to<a href="http://www.cpanel.net/support/docs/ea/ea3/customdirectives.html"> Cpanel Docs</a>.</strong></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/18/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/16/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2012/11/xen-add-extra-partitions-to-guest-os/">Xen: Add Extra Partitions to Guest OS</a>
      </li>
    
      <li class="post">
        <a href="/2012/11/howto-bulk-import-dns-zones-to-softlayer-dns-using-cpanel/">HowTo: Bulk Import DNS Zones to Softlayer DNS using Cpanel</a>
      </li>
    
      <li class="post">
        <a href="/2012/08/integrate-sendgrid-with-redmine/">Integrate Sendgrid with Redmine</a>
      </li>
    
      <li class="post">
        <a href="/2012/07/rsback-task-x-is-locked-and-cannot-be-executed/">rsback: task x is locked and cannot be executed</a>
      </li>
    
      <li class="post">
        <a href="/2012/06/restore-xen-vm-from-lvm-snapshot-backups/">Restore Xen VM from LVM Snapshot Backups</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/promet">@promet</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'promet',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("linuxsysadmnblg", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/linuxsysadmnblg" class="twitter-follow-button" data-show-count="false">Follow @linuxsysadmnblg</a>
  
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Promet OPS Team -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'linuxsysadminblog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
